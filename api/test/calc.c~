/* Testbed for the Hipe API */

#include <hipe.h>
#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>

int main()
{
    //Request a new top-level application frame from the Hipe server
    hipe_session session = hipe_open_session(0,0,0,"Calculator");
    if(!session) exit(1);

    //Apply initial styling rules
    hipe_send(session, HIPE_OPCODE_SET_STYLESHEET, 0,0, "\
body {height:100%; margin:0;}\
button {height:100%; width:100%; display:block; font-size: large;}\
table {position:absolute; height:100%; width:100%;}\
td {width: 25%}\
.mantissa {text-align:right; border:solid 2px; border-radius:5px;}\
    ",0);

    //Specify initial window contents
    hipe_send(session, HIPE_OPCODE_SET_BODY, 0,0, "\
<table><tbody>\
<tr><td class=\"mantissa\" colspan=\"4\">0.</td></tr>\
<tr><td><button>C</button></td><td><button>CE</button></td><td><button>&div;</button></td><td><button>&times;</button></td></tr>\
<tr><td><button>7</button></td><td><button>8</button></td><td><button>9</button></td><td><button>&minus;</button></td></tr>\
<tr><td><button>4</button></td><td><button>5</button></td><td><button>6</button></td><td><button>+</button></td></tr>\
<tr><td><button>1</button></td><td><button>2</button></td><td><button>3</button></td><td rowspan=\"2\"><button>=</button></td></tr>\
<tr><td colspan=\"2\"><button>0</button></td><td><button>.</button></td></tr>\
</tbody></table>\
    ",0);

////OLD STUFF FOLLOWS FROM DIGITAL CLOCK COPIED OVER LOL

/*
    //request a reference to the <div> element so we can play with it. 
    hipe_send(session, HIPE_OPCODE_GET_LAST_CHILD, 0,0,0,0); 
    hipe_instruction instruction;
    hipe_instruction_init(&instruction);
    hipe_await_instruction(session, &instruction, HIPE_OPCODE_LOCATION_RETURN);
    uint64_t div_tag = instruction.location;

    //Populate the <div> tag with some styling.
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "background-color", "#052205");
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "color", "white");
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "border-radius", "0.1em");
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "bottom", "20%");
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "left", "25%");
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "position", "absolute");
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "font-size", "400%");
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "padding", "0.25em");
    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, div_tag, "text-shadow", "2px 2px green");
    
 
    hipe_send(session, HIPE_OPCODE_APPEND_INSIDE, 0, div_tag, "<span></span><span></span>", 0); 
    

    hipe_send(session, HIPE_OPCODE_GET_FIRST_CHILD, 0, div_tag,0,0); 
    hipe_instruction_clear(&instruction);
    hipe_await_instruction(session, &instruction, HIPE_OPCODE_LOCATION_RETURN);
    uint64_t big_digits = instruction.location;

    hipe_send(session, HIPE_OPCODE_GET_LAST_CHILD, 0, div_tag,0,0); 
    hipe_instruction_clear(&instruction);
    hipe_await_instruction(session, &instruction, HIPE_OPCODE_LOCATION_RETURN);
    uint64_t small_digits = instruction.location;

    hipe_send(session, HIPE_OPCODE_SET_STYLE, 0, small_digits, "font-size", "50%");
    hipe_send(session, HIPE_OPCODE_EVENT_REQUEST, 0, small_digits, "mouseover", "");
    hipe_send(session, HIPE_OPCODE_EVENT_REQUEST, 0, small_digits, "click", "");
    //hipe_send(session, HIPE_OPCODE_EVENT_CANCEL, 0, small_digits, "mouseover", "");
*/
    //For now, just loop until the user hits ^C to terminate the application.
    while(1) {
        usleep(500000);
    }
    return 0;
}
